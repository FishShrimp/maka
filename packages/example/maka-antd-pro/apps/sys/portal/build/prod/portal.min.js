!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("maka"),require("react")):"function"==typeof define&&define.amd?define(["maka","react"],t):"object"==typeof exports?exports["MakaApp-portal"]=t(require("maka"),require("react")):e["MakaApp-portal"]=t(e.maka,e.react)}(window,function(n,a){return function(n){var a={};function o(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=n,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=9)}([function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=n},function(e,t,n){e.exports=n(10)},function(e,t){function s(e,t,n,a,o,r,i){try{var c=e[r](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(a,o)}e.exports=function(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var a=c.apply(e,i);function o(e){s(a,t,n,o,r,"next",e)}function r(e){s(a,t,n,o,r,"throw",e)}o(void 0)})}}},function(e,t,n){var o=n(0);e.exports=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(e){o(t,e,n[e])})}return t}},function(e,t,n){var a=n(12),o=n(13),r=n(14);e.exports=function(e,t){return a(e)||o(e,t)||r()}},function(e){e.exports={isMakaApp:!0,name:"portal",description:"portal application, a simple example of portal.",version:"1.0.0",license:"MIT",author:"ziaochina",repository:{type:"git",url:"https://github.com/makajs/maka.git"},bugs:{url:"https://github.com/makajs/maka/issues"},homepage:"https://github.com/makajs/maka#readme",scripts:{start:"maka start",dev:"maka start --dev",build:"maka build",pkg:"maka pkg"},dependencies:{},server:{proxy:null,port:8e3},subAppDir:["./apps","../../../"],devDependencies:{antd:"^3.11.6"}}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){e.exports=a},function(e,t,n){e.exports=n(19)},function(e,t,n){var a=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=a.regeneratorRuntime&&0<=Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime"),r=o&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,e.exports=n(11),o)a.regeneratorRuntime=r;else try{delete a.regeneratorRuntime}catch(e){a.regeneratorRuntime=void 0}},function(j,e){!function(e){"use strict";var s,t=Object.prototype,l=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag",i="object"==typeof j,c=e.regeneratorRuntime;if(c)i&&(j.exports=c);else{(c=e.regeneratorRuntime=i?j.exports:{}).wrap=b;var d="suspendedStart",u="suspendedYield",m="executing",h="completed",f={},p={};p[o]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g($([])));v&&v!==t&&l.call(v,o)&&(p=v);var y=N.prototype=w.prototype=Object.create(p);k.prototype=y.constructor=N,N.constructor=k,N[r]=k.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,N):(e.__proto__=N,r in e||(e[r]="GeneratorFunction")),e.prototype=Object.create(y),e},c.awrap=function(e){return{__await:e}},T(L.prototype),L.prototype[a]=function(){return this},c.AsyncIterator=L,c.async=function(e,t,n,a){var o=new L(b(e,t,n,a));return c.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},T(y),y[r]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(n){var a=[];for(var e in n)a.push(e);return a.reverse(),function e(){for(;a.length;){var t=a.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},c.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=s)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function e(e,t){return r.type="throw",r.arg=n,a.next=e,t&&(a.method="next",a.arg=s),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],r=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var i=l.call(o,"catchLoc"),c=l.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&l.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:$(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=s),f}}}function b(e,t,n,a){var r,i,c,s,o=t&&t.prototype instanceof w?t:w,l=Object.create(o.prototype),p=new S(a||[]);return l._invoke=(r=e,i=n,c=p,s=d,function(e,t){if(s===m)throw new Error("Generator is already running");if(s===h){if("throw"===e)throw t;return M()}for(c.method=e,c.arg=t;;){var n=c.delegate;if(n){var a=C(n,c);if(a){if(a===f)continue;return a}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(s===d)throw s=h,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s=m;var o=x(r,i,c);if("normal"===o.type){if(s=c.done?h:u,o.arg===f)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s=h,c.method="throw",c.arg=o.arg)}}),l}function x(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function k(){}function N(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function L(s){var t;this._invoke=function(n,a){function e(){return new Promise(function(e,t){!function t(e,n,a,o){var r=x(s[e],s,n);if("throw"!==r.type){var i=r.arg,c=i.value;return c&&"object"==typeof c&&l.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(c).then(function(e){i.value=e,a(i)},function(e){return t("throw",e,a,o)})}o(r.arg)}(n,a,e,t)})}return t=t?t.then(e,e):e()}}function C(e,t){var n=e.iterator[t.method];if(n===s){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=s,C(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var a=x(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,f;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=s),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function $(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(l.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=s,e.done=!0,e};return a.next=a}}return{next:M}}function M(){return{value:s,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){e.exports=n.p+"logo.png"},function(e,t,n){e.exports=n.p+"photo.png"},function(e,t,n){e.exports=n.p+"empty.svg"},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a,o=n(2),l=n.n(o),r=n(3),i=n.n(r),c=n(6),f=n(1),s=n(4),p=n.n(s),d={content:"portal-content",header:{header:"antd-pro-components-global-header-index-header",logo:"antd-pro-components-global-header-index-logo",menu:"antd-pro-components-global-header-index-menu",trigger:"antd-pro-components-global-header-index-trigger",right:"antd-pro-components-global-header-index-right",action:"antd-pro-components-global-header-index-action",search:"antd-pro-components-global-header-index-search",account:"antd-pro-components-global-header-index-account",avatar:"antd-pro-components-global-header-index-avatar",dark:"antd-pro-components-global-header-index-dark",name:"antd-pro-components-global-header-index-name",dropdown:{container:"antd-pro-components-header-dropdown-index-container"}},sider:{sider:"antd-pro-components-sider-menu-index-sider",light:"antd-pro-components-sider-menu-index-light",logo:"antd-pro-components-sider-menu-index-logo",icon:"antd-pro-components-sider-menu-index-icon",fixSiderbar:"antd-pro-components-sider-menu-index-fixSiderbar"},lang:{dropDown:"antd-pro-components-select-lang-index-dropDown",menu:"antd-pro-components-select-lang-index-menu"}},u={component:"antd.Dropdown",overlayClassName:d.header.dropdown.container,overlay:{component:"antd.Menu",className:"portal-menu",selectedKeys:[],onClick:"{{$topMenuClick}}",children:[{component:"antd.Menu.Item",key:"userCenter",children:[{component:"antd.Icon",type:"user"},"{{$i18n('menu.account.center')}}"]},{component:"antd.Menu.Item",key:"userSetting",children:[{component:"antd.Icon",type:"setting"},"{{$i18n('menu.account.settings')}}"]},{component:"antd.Menu.Item",key:"devtool",children:[{component:"antd.Icon",type:"tool"},"{{$i18n('menu.devtool')}}"]},{component:"antd.Menu.Item",key:"appstore",children:[{component:"antd.Icon",type:"appstore"},"{{$i18n('menu.appstore')}}"]},{component:"antd.Menu.Divider"},{component:"antd.Menu.Item",key:"logout",children:[{component:"antd.Icon",type:"logout"},"{{$i18n('menu.account.logout')}}"]}]},children:{component:"span",className:d.header.action+" "+d.header.account,children:[{component:"antd.Avatar",size:"small",alt:"avatar",src:"photo.png",className:d.header.avatar},{component:"span",className:d.header.name,children:"{{data.other.currentUser?data.other.currentUser.name:'13334445556'}}"}]}},m={component:"antdpro.NoticeIcon",className:d.header.action,count:"{{!data.notices.unread ? 0 : data.notices.unread.notification + data.notices.unread.message +data.notices.unread.event}}",locale:{emptyText:"{{$i18n('component.noticeIcon.empty')}}",clear:"{{$i18n('component.noticeIcon.clear')}}"},clearClose:!0,onClear:"{{$clearNotice}}",children:[{component:"antdpro.NoticeIcon.Tab",title:"{{$i18n('component.globalHeader.notification')}}",name:"notification",emptyText:"{{$i18n('component.globalHeader.notification.empty')}}",emptyImage:"empty.svg",count:"{{data.notices.unread && data.notices.unread.notification}}",list:"{{data.notices.value && data.notices.value.notification}}"},{component:"antdpro.NoticeIcon.Tab",title:"{{$i18n('component.globalHeader.message')}}",name:"message",emptyText:"{{$i18n('component.globalHeader.message.empty')}}",emptyImage:"empty.svg",count:"{{data.notices.unread && data.notices.unread.message}}",list:"{{data.notices.value && data.notices.value.message}}"},{component:"antdpro.NoticeIcon.Tab",title:"{{$i18n('component.globalHeader.event')}}",name:"event",emptyText:"{{$i18n('component.globalHeader.event.empty')}}",emptyImage:"empty.svg",count:"{{data.notices.unread && data.notices.unread.event}}",list:"{{data.notices.value && data.notices.value.event}}"}]},h={component:"antd.Layout.Header",style:{padding:0,width:!0},className:"{{data.setting.fixedHeader ? ".concat(d.header.fixedHeader,": ''}}"),children:{component:"div",className:d.header.header,children:[{component:"a",className:d.header.logo,onClick:"{{()=>{$drawerVisible(!$base.gs('data.setting.drawerVisible'))}}}",children:{component:"img",src:"{{$image.logo}}",alt:"logo",width:"32"},_visible:"{{isMobile}}"},{component:"span",className:d.header.trigger,onClick:"{{()=>$onCollapse(!data.setting.collapsed)}}",children:{component:"antd.Icon",type:"{{data.setting.collapsed? 'menu-unfold' : 'menu-fold'}}"}},{component:"div",className:d.header.right,children:[{component:"antdpro.HeaderSearch",className:d.header.action+" "+d.header.search,placeholder:"{{$i18n('component.globalHeader.search')}}",dataSource:"{{[$i18n('component.globalHeader.search.example1'),$i18n('component.globalHeader.search.example2')]}}",onSearch:"{{value => {\n                    console.log('input', value);\n                }}}",onPressEnter:"{{value => {\n                    console.log('enter', value); \n                  }}}"},{component:"antd.Tooltip",title:"{{$i18n('component.globalHeader.help')}}",children:{component:"a",className:d.header.action,onClick:"{{()=>$setContent('doc', 'doc')}}",children:{component:"antd.Icon",type:"question-circle-o"}}},m,u,{component:"LocaleSelector",overlayClassName:d.header.dropdown.container,className:d.lang.dropDown+" "+d.header.action}]}]}},g={component:"antd.Layout.Sider",trigger:"{{null}}",collapsible:!0,collapsed:"{{data.setting.collapsed}}",breakpoint:"lg",onCollapse:"{{$onCollapse}}",width:256,theme:"{{data.setting.theme}}",className:"{{$classnames('".concat(d.sider.sider,"',{\n        '").concat(d.sider.fixSiderbar,"': data.fixSiderbar,\n        '").concat(d.sider.light,"': data.setting.theme === 'light'\n    })}}"),children:[{component:"div",className:d.sider.logo,children:[{component:"img",src:"{{$image.logo}}"},{component:"h1",children:"Application"}]},{component:"antd.Menu",mode:"{{data.setting.mode}}",theme:"{{data.setting.theme}}",selectedKeys:"{{$getMenuSelectKeys()}}",onClick:"{{$menuClick}}",onOpenChange:"{{$menuOpenChange}}",openKeys:"{{{return data.menuOpenKeys}}}",style:{padding:"16px 0",width:"100%"},className:"{{$classnames({'top-nav-menu': data.setting.mode === 'horizontal'})}}",children:"{{$getMenuChildren()}}"}]},v={component:"antd.Layout.Content",className:d.content,children:[{component:"div",className:"portal-content-main",_visible:"{{!!(data.content && data.content.appName)}}",children:[{component:"div",className:"portal-content-main-tabs",children:{component:"antd.Tabs",type:"editable-card",hideAdd:!0,activeKey:"{{data.content && data.content.appName}}",onChange:"{{$tabChange}}",onEdit:"{{$tabEdit}}",children:[{_for:"item in data.openTabs",component:"antd.Tabs.TabPane",key:"{{item.appName}}",tab:"{{{\n                        if(item.title){\n                            return $i18n(item.title) || item.title\n                        }\n                        else{\n                            var hit = $findMenu(data.menu,item.appName)\n                            return hit ? $i18n(hit.locale): ''\n                        }\n                    }}}"}],_visible:"{{ data.isTabsStyle && data.openTabs && data.openTabs.length > 0}}"}},{component:"div",className:"portal-content-main-app",children:{_for:"item in data.openTabs",component:"AppLoader",appName:"{{item && item.appName }}",onPortalReload:"{{$reload}}",setPortalContent:"{{$setContent}}",addTabCloseListener:"{{$addTabCloseListener}}",removeTabCloseListener:"{{$removeTabCloseListener}}",addTabActiveListener:"{{$addTabActiveListener}}",removeTabActiveListener:"{{$removeTabActiveListener}}",isTabStyle:"{{data.isTabsStyle}}","...":"{{item && item.appProps}}",isHide:"{{ item.alwaysRender && (!data.content || data.content.appName != item.appName)}}",_notRender:"{{!(data.content && data.content.appName == item.appName) && !item.alwaysRender}}"}}]}]},y={component:"Media",_visible:"{{data.menu.length > 0}}",query:"(max-width: 599px)",children:{_function:"(isMobile)",component:"div",children:[{component:"ReactContainerQuery.ContainerQuery",query:{"portal-screen-xs":{maxWidth:575},"portal-screen-sm":{minWidth:576,maxWidth:767},"portal-screen-md":{minWidth:768,maxWidth:991},"portal-screen-lg":{minWidth:992,maxWidth:1199},"portal-screen-xl":{minWidth:1200,maxWidth:1599},"portal-screen-xxl":{minWidth:1600}},children:{_function:"(params)",component:"div",className:"{{$classnames('portal',params)}}",children:{component:"antd.Layout",prefixCls:"ant-layout",hasSider:"{{{return !isMobile && data.setting.layout != 'topmenu'}}}",children:[{component:"antd.Drawer",visible:"{{data.setting.drawerVisible}}",placement:"left",onClose:"{{()=>$drawerVisible(false)}}",style:{padding:0,height:"100vh"},children:p()({},g,{collapsed:!1}),_visible:"{{isMobile}}"},p()({},g,{_visible:"{{!isMobile}}"}),{component:"antd.Layout",hasSider:!1,style:"{{$getLayoutStyle(isMobile)}}",children:[h,v]},{component:"div",className:"portal-option",onClick:"{{$openOption}}",children:{component:"antd.Icon",type:"setting"}},{component:"antd.Drawer",closable:!0,onClose:"{{$openOption}}",visible:"{{data.optionVisible}}",placement:"right",children:{component:"AppLoader",appName:"option",onPortalReload:"{{$reload}}"}}]}}}]}},b=n(7),x=n.n(b),w=n(0),k=n.n(w),N=n(5),T=n.n(N),L=n(8),C=n.n(L),_={data:{menu:[],menuSelectedKeys:[],menuDefaultOpenKeys:[],content:{},openTabs:[],isTabsStyle:!0,isFoldMenu:!0,other:{},optionVisible:!1,setting:{mode:"inline",theme:"dark",collapsed:!1,layout:"sidermenu",contentWidth:"Fluid",fixHeader:!1,fixSiderbar:!0,autoHideHeader:!1,colorWeak:!1,collapse:!0},notices:[]}},O={},S=function(e){var a=Object(f.getComponent)("antd.Tag"),o=Object(f.getAction)("moment"),t=Object(f.getAction)("lodash");if(0===e.length)return{};var n=e.map(function(e){var t=p()({},e);if(t.datetime&&(t.datetime=o(e.datetime).fromNow()),t.id&&(t.key=t.id),t.extra&&t.status){var n={todo:"",processing:"blue",urgent:"red",doing:"gold"}[t.status];t.extra=C.a.createElement(a,{color:n,style:{marginRight:0}},t.extra)}return t});return t.groupBy(n,"type")},$=function(e){var o={};return Object.entries(e).forEach(function(e){var t=T()(e,2),n=t[0],a=t[1];o[n]||(o[n]=0),Array.isArray(a)&&(o[n]=a.filter(function(e){return!e.read}).length)}),o},M=Object(f.actionMixin)("base","webapi","modal","lodash","moment","classnames","image","i18n")(a=function e(t){var h=this;x()(this,e),k()(this,"onInit",function(){h.load(),f.navigate.listen(h.listen);var e,t=f.navigate.getLocation();e="/portal"==f.navigate.getLocation().pathname?"/portal/dashboard-analysis":t.pathname+t.search,f.navigate.redirect(e)}),k()(this,"load",i()(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.webapi.portal.getMenu();case 2:return t=e.sent,e.next=5,h.webapi.option.query();case 5:return n=e.sent,e.next=8,h.webapi.notice.query();case 8:a=e.sent,a=S(a),h.base.setState({"data.menu":t,"data.setting":n,"data.notices":{value:a,unread:$(a)}});case 11:case"end":return e.stop()}},e,this)}))),k()(this,"reload",i()(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.webapi.portal.getMenu();case 2:return t=e.sent,e.next=5,h.webapi.option.query();case 5:n=e.sent,t=_.data.menu.concat(t),h.base.setState({"data.menu":t,"data.setting.theme":n.theme});case 8:case"end":return e.stop()}},e,this)}))),k()(this,"getCurrentUser",function(){return h.base.context.get("currentUser")||{}}),k()(this,"getMenuChildren",function(){return{_isMeta:!0,value:function n(e,a){var o=[];return e.forEach(function(e){var t={name:e.appName,key:e.appName};e.isGroup?(t.component="antd.Menu.ItemGroup",t.title=h.i18n(e.locale)||e.title,e.children&&(t.children=n(e.children,a+1))):e.children?(t.component="antd.Menu.SubMenu",t.children=n(e.children,a+1),e.icon||1==a?t.title=[{component:"antd.Icon",className:"anticon",type:e.icon||"desktop"},{component:"span",children:h.i18n(e.locale)||e.title}]:t.title=h.i18n(e.locale)||e.title):(t.component="antd.Menu.Item",e.icon||1==a?t.children=[{component:"antd.Icon",type:e.icon||"desktop",className:"anticon"},{name:"name",component:"span",children:h.i18n(e.locale)||e.title}]:t.children=h.i18n(e.locale)||e.title),!1!==e.isVisible&&o.push(t)}),o}(h.base.gs("data.menu"),1)}}),k()(this,"topMenuClick",function(){var t=i()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.key,e.next="logout"===e.t0?3:"userCenter"===e.t0?7:"userSetting"===e.t0?9:"devtool"===e.t0?11:"appstore"===e.t0?13:15;break;case 3:return h.base.context.set("currentUser",void 0),f.fetch.clearAccessToken(),f.navigate.redirect("/sign-in"),e.abrupt("break",15);case 7:return h.setContent("","account-center"),e.abrupt("break",15);case 9:return h.setContent("","account-setting"),e.abrupt("break",15);case 11:return h.modal.show({title:h.i18n("menu-devtool"),children:Object(f.createAppElement)("devtools",{onPortalReload:h.reload}),bodyStyle:{height:450},width:1100}),e.abrupt("break",15);case 13:return h.modal.show({title:h.i18n("menu-appstore"),children:Object(f.createAppElement)("app-store",{onPortalReload:h.reload}),bodyStyle:{height:450},width:1100}),e.abrupt("break",15);case 15:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}()),k()(this,"menuClick",function(e){var t=h.findMenu(h.base.gs("data.menu"),e.key);t&&(t.isModal?h.modal.show(p()({title:"开发工具",children:Object(f.createAppElement)(t.appName,{})},t)):h.setContent(t.locale,t.appName,t.appProps,t.alwaysRender))}),k()(this,"menuOpenChange",function(e){h.base.ss({"data.menuOpenKeys":e&&0<e.length?[e[e.length-1]]:[]})}),k()(this,"getMenuSelectKeys",function(){var e=h.base.gs("data.content");if(e){var t=h.findMenu(h.base.gs("data.menu"),e.appName);return t?[t.appName]:[]}}),k()(this,"tabChange",function(t){var e=h.base.gs("data.openTabs").find(function(e){return e.appName==t});h.setContent(e.title,e.appName,e.appProps,e.alwaysRender)}),k()(this,"tabEdit",function(){var n=i()(l.a.mark(function e(t,n){var a,o,r,i,c,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("remove"!=n){e.next=17;break}if(a=O["".concat(t,"__close")],e.t0=a,e.t0)return e.next=6,a();e.next=7;break;case 6:e.t0=!e.sent;case 7:if(e.t0)return e.abrupt("return");e.next=9;break;case 9:o=h.base.gs("data.openTabs")||[],r=o.findIndex(function(e){return e.appName==t}),o.splice(r,1),i=0<o.length?o[o.length-1]:{},(c=O["".concat(i.appName,"__active")])&&setTimeout(c,16),s={"data.openTabs":o,"data.content":i},h.base.setState(s);case 17:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}()),k()(this,"findMenu",function(e,l){return function e(t){var n,a=!0,o=!1,r=void 0;try{for(var i,c=t[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var s=i.value;if(s.appName==l){n=s;break}if(s.children&&(n=e(s.children)))break}}catch(e){o=!0,r=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}return n}(e)}),k()(this,"foldMenu",function(){h.base.ss({"data.isFoldMenu":!h.base.gs("data.isFoldMenu")})}),k()(this,"setContent",function(t,n,e,a){if(n){var o=h.base.getState("data"),r=o.menu,i=o.openTabs||[],c=o.isTabsStyle,s=h.findMenu(r,n),l={},p=o.content;if(!p||n!=p.appName){t=t||s&&s.title,e=e||s&&s.appProps||{};var d={title:t,appName:n,appProps:e,alwaysRender:a};l["data.content"]=d;var u=i.findIndex(function(e){return e.title==t&&t||e.appName==n});if(-1!=u)if(c){var m=O["".concat(d.appName,"__active")];m&&setTimeout(m,16),l["data.openTabs."+u]=d}else(i=[]).push(d),l["data.openTabs"]=i;else c||(i=[]),i.push(d),l["data.openTabs"]=i;h.base.setState(l),setTimeout(function(){var e=f.navigate.getLocation(),t="".concat(e.pathname).concat(e.search).split("/");(t=t.slice(0,t.indexOf("portal")+1)).push(d.appName),f.navigate.redirect(t.join("/"))},0)}}}),k()(this,"openOption",function(){h.base.setState({"data.optionVisible":!h.base.getState("data.optionVisible")})}),k()(this,"addTabCloseListener",function(e,t){O[e+"__close"]=t}),k()(this,"removeTabCloseListener",function(e){O[e+"__close"]&&delete O[e+"__close"]}),k()(this,"addTabActiveListener",function(e,t){O[e+"__active"]=t}),k()(this,"removeTabActiveListener",function(e){O[e+"__active"]&&delete O[e+"__active"]}),k()(this,"listen",function(e,t){var n="".concat(e.pathname).concat(e.search);if(n&&-1!=n.indexOf("portal")){var a=n.split("/"),o=a[a.length-1];"portal"!=o&&o?h.setContent("",o):h.base.ss({"data.openTabs":[],"data.content":{}})}}),k()(this,"componentWillUnmount",function(){f.navigate.unlisten(h.listen)}),k()(this,"getLayoutStyle",function(e){var t=h.base.gs("data.setting");t.fixSiderbar,t.collapsed,t.layout;return{minHeight:"100vh"}}),k()(this,"onCollapse",function(e){h.base.ss({"data.setting.collapsed":e})}),k()(this,"drawerVisible",function(e){h.base.ss({"data.setting.drawerVisible":e})}),k()(this,"clearNotice",function(e){var t;h.base.ss((t={},k()(t,"data.notices.value.".concat(e),[]),k()(t,"data.notices.unread.".concat(e),0),t))}),Object.assign(this,t.mixins)})||a,j=f.fetch.mockData;function E(){j.users||(j.users=[{id:1,account:13334445556,password:"c4ca4238a0b923820dcc509a6f75849b",name:"zlj"}]),j.menu||(j.menu=[{key:"1",title:"Home",appName:"zlj-home",appProps:{},icon:"home",isDefault:!0}])}f.fetch.mock("/v1/portal/init",function(e,t){if(E(),t&&t.token){var n=t.token.split(","),a=T()(n,6),o=a[0],r=a[1],i=a[2],c=a[3],s=a[4],l=a[5],p=j.users.find(function(e){return e.id==o});return p?p.nickname=p.nickname||p.mobile:(p={id:o,mobile:r,password:i,nickname:c||r,sex:s,birthday:l},j.user.push(p)),{result:!0,value:{user:p}}}return{result:!0,value:{}}}),f.fetch.mock("/v1/logout",function(){return E(),f.fetch.clearAccessToken(),{result:!0,value:!0}});n(15),n(16),n(17),n(18);n.d(t,"name",function(){return I}),n.d(t,"beforeRegister",function(){return P}),n.d(t,"view",function(){return y}),n.d(t,"state",function(){return _}),n.d(t,"action",function(){return M});var I=c.name;function P(){return A.apply(this,arguments)}function A(){return(A=i()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.load)(["template","react-container-query","react-media","webapi","style"]);case 2:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}}])});